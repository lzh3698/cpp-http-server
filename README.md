# C++ 高性能HTTP服务器

一个基于Linux、从套接字编程开始实现的轻量级HTTP/1.1服务器。本项目核心目标是**深入探究网络编程、并发模型与服务器性能优化的基本原理**，而非实现一个功能完备的Web框架。

## 核心特性与设计

- **Reactor事件驱动模型**：主线程通过 `epoll` 进行高效的I/O多路复用，将就绪的连接分发给工作线程，实现高并发基础。
- **生产者-消费者线程池**：自主实现的通用线程池，负责处理HTTP解析与响应生成，避免阻塞事件循环。
- **零拷贝文件传输**：对静态文件请求，使用 `sendfile` 系统调用，数据在内核空间直接传送，极大提升I/O性能。
- **同步日志系统**：线程安全的日志模块，记录连接生命周期与请求细节，便于调试和状态监控。
- **工程化实践**：遵循RAII原则管理资源，使用智能指针，通过Makefile组织构建。

### 连接模型说明
本项目当前采用 **“请求-响应后关闭”的连接模型**。服务器在完整处理一个HTTP请求并发送响应后，将主动关闭TCP连接。此设计在项目初期简化了连接状态管理与资源回收的复杂度，使其更专注于**Reactor与线程池协同**这一核心架构。

> **技术视角**：HTTP/1.1协议本身支持长连接（Keep-Alive），本项目的协议解析层已为此准备好基础。将当前模型扩展为支持持久连接，主要涉及连接对象状态的持久化与超时管理，是架构上清晰可预见的下一个优化方向。

## 架构总览
    [客户端连接] (多个TCP连接) -> 主线程(Main Reactor) -> 派发就绪的I/O事件至任务队列 -> 工作线程池拉取 -> 线程池(处理HTTP请求: 解析->生成响应) -> 主线程发送响应 (使用sendfile) -> [响应完成，关闭连接]

## 快速开始

### 1. 环境与构建
- **环境**：  
  Linux，g++ (支持C++11或以上)
- **构建**：  
  make
  
- **启动服务器**  
  ./http_server
  (默认监听8080端口)
  
- **发送测试请求**  
  curl -v http://localhost:8080/…（/static/目录中的文件）  
  （程序默认访问的静态文件目录为/static/）

## 性能关注点
在开发环境（如：CentOS 7.9, 2核CPU）中，本项目关注并验证了以下性能关键设计：

计算与I/O分离：线程池隔离了阻塞的业务处理，保证事件循环的响应性。

数据传输优化：sendfile 零拷贝是静态文件服务的性能基石。

## 深入实现细节
1. Reactor事件循环
主线程维护一个epoll实例，监听监听套接字和所有已接受连接套接字的可读事件。采用水平触发与非阻塞I/O，确保只有在数据真正到达时才触发事件。

2. 协议解析
实现了基于状态机的HTTP/1.1基础解析器，可正确解析请求行、请求头。

3. 关键问题与解决
端口TIME_WAIT状态：通过设置SO_REUSEADDR套接字选项，允许服务器快速重启。

老旧环境开发：在缺乏现代工具链（如高版本gcc、valgrind）的CentOS 7.9上完成开发，展示了问题排查和替代方案解决能力。

## 扩展方向
本项目作为学习型项目，在现有清晰架构上，可沿多个方向深化：

连接管理：实现HTTP/1.1持久连接（Keep-Alive）与空闲超时断开。

配置化：从硬编码参数过渡到配置文件驱动。

协议增强：支持 POST 方法及表单处理。

这些扩展均是架构的自然演进，而非重构。

## 项目结构
```
cpp-http-server/               // 项目根目录  
├── include/                   // 公共头文件  
│   ├── logger.h               // 日志系统接口  
│   └── thread_pool.h          // 线程池模板实现  
├── src/                       // 源文件  
│   ├── logger.cpp             // 日志系统实现  
│   ├── thread_pool.cpp        // 线程池实现  
│   └── http_server.cpp        // 服务器主逻辑 (epoll, HTTP解析等)  
├── .ignore                    // 忽视文件  
├── makefile                   // 构建脚本  
└── http_server_log            // 运行时日志文件 (程序启动后自动生成)  
```
